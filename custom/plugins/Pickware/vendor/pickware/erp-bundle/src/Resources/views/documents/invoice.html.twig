{% sw_extends '@Framework/documents/invoice.html.twig' %}

{% block document_head %}
    {{ parent() }}
    {# Override the fixed product-label column width from Shopware's base styles to avoid
       undesired line breaks when batch information is displayed in the line item label. #}
    <style>
        .line-item-table-header > th.product-label {
            width: auto;
        }
    </style>
{% endblock %}

{#
This override is needed for the special case where all line items have quantity zero and thus are removed by
Pickware\PickwareErpStarter\Invoice\InvoiceGenerationLineItemFilterSubscriber. In this case, Shopware falsely
does not render the 'loop'-block at all, which includes the shipping costs as well as the page header and the table.
Thus, we render the block here once, if there are no line items (i.e. total = 0).
#}
{% block document_body %}
    {% set position = 1 %}
    {% set prefix = '' %}
    {% set level = 0 %}

    {% if total == 0 %}
        {% set total = 1 %}
        {% set onlyShippingCosts = true %}
        {{ block('loop') }}
    {% endif %}

    {{ parent() }}
{% endblock %}

{# This override is needed because the position template otherwise produces an empty line with a zero-sum column. #}
{% block position %}
    {% if onlyShippingCosts %}
        {% set class = '' %}
        {% if level > 0 %}
            {% set class = " nested level-" ~ level %}
        {% endif %}

        {# This is needed to fix the styling of the table header, othewise it ends in the middle of the table. #}
        <tr class="line-item{{ class }}">
            <td colspan="6" style="padding-top: 0"></td>
        </tr>
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block document_payment_shipping_inner %}
    {{ parent() }}

    {% set isEu = shippingAddress.country.isEu %}
    {% if config.pickwareErpDisplayTaxExemptExportLabel
        and isEu === false
        and order.price.taxStatus === 'tax-free'
    %}
        {{ 'pickware-erp-starter.invoice-document.tax-exempt-export'|trans }}<br>
    {% endif %}
{% endblock %}

{% block document_line_item_table_column_label %}
    {{ parent() }}

    {% sw_include '@PickwareErpBundle/documents/components/batch-line-item-row.html.twig' with { lineItem } %}
    {% sw_include '@PickwareErpBundle/documents/components/picking-properties-line-item-row.html.twig' with { lineItem } %}
    {% sw_include '@PickwareErpBundle/documents/components/custom-fields-line-item-row.html.twig' with { lineItem, config } %}
{% endblock %}

{% block shipping_address %}
    {{ parent() }}
    {% sw_include '@PickwareErpBundle/documents/components/custom-fields-order.html.twig' with { config } %}
{% endblock %}
