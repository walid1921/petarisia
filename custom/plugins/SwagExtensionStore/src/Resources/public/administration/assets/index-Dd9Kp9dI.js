const d=`{% block sw_extension_buy_modal %} <sw-modal class="sw-extension-buy-modal" :title="$t('sw-extension-store.component.sw-extension-buy-modal.title')" size="600px" :is-loading="isLoading" @modal-close="emitClose" > {% block sw_extension_buy_modal_content %} <template v-if="checkoutStep === checkoutSteps.SUCCESS"> {% block sw_extension_buy_modal_adding_success_content %} <sw-extension-adding-success @close="emitClose" /> {% endblock %} </template> <template v-else-if="checkoutStep === checkoutSteps.FAILED"> {% block sw_extension_buy_modal_adding_failed_content %} <sw-extension-adding-failed :extension-name="extension.name" :title="checkoutError && checkoutError.title" :detail="checkoutError && checkoutError.detail" :documentation-link="checkoutErrorDocumentationLink" @close="emitClose" /> {% endblock %} </template> <template v-else> {% block sw_extension_buy_modal_content_not_installed %} {% block sw_extension_buy_modal_variant_selection %} <div class="sw-extension-buy-modal__variants-selection"> {% block sw_extension_buy_modal_variant_selection_content %} {% block sw_extension_buy_modal_variant_selection_extension_preview %} <div class="sw-extension-buy-modal__extension-summary"> {% block sw_extension_buy_modal_variant_selection_extension_preview_content %} {% block sw_extension_buy_modal_variant_selection_extension_icon %} <sw-extension-icon :src="extension.icon" /> {% endblock %} {% block sw_extension_buy_modal_variant_selection_extension_name %} <h4 class="sw-extension-buy-modal__extension-summary-name"> {{ extension.label }} </h4> {% endblock %} {% block sw_extension_buy_modal_variant_selection_extension_trial_phase %} <p v-if="isVariantOfTypeRent(selectedVariant) && firstMonthFree" class="sw-extension-buy-modal__extension-summary-trial-phase" > <mt-icon name="regular-check-circle" size="16px" /> {{ $t('sw-extension-store.buy-modal.rent.freeTrial') }} </p> {% endblock %} {% block sw_extension_buy_modal_variant_selection_extension_disclaimer %} <p v-if="isVariantOfTypeRent(selectedVariant)" class="sw-extension-buy-modal__extension-summary-disclaimer" > {{ $t('sw-extension-store.buy-modal.rent.disclaimer') }} </p> {% endblock %} {% endblock %} </div> {% endblock %} {% block sw_extension_buy_modal_variant_selection_variant_list %} <ul> {% block sw_extension_buy_modal_variant_selection_variant_list_item %} <li v-for="variant in recommendedVariants" :key="variant.id" class="sw-extension-buy-modal__variants-card" :class="variantCardClass(variant)" @click="onChangeVariantSelection(variant)" > {% block sw_extension_buy_modal_variant_selection_variant_list_item_radio_button %} <div class="sw-extension-buy-modal__variants-card-input sw-field--radio"> <div class="sw-field__radio-input"> <input :id="\`sw-extension-buy-modal__variant-\${variant.type}\`" type="radio" name="variant-selection" :value="variant.id" :checked="variant.id === selectedVariantId" :disabled="isLoading || recommendedVariants.length <= 1" > <div class="sw-field__radio-state" /> </div> </div> {% endblock %} {% block sw_extension_buy_modal_variant_selection_variant_list_item_variant_label %} {% block sw_extension_buy_modal_variant_selection_variant_list_item_variant_label_description %} <label :for="\`sw-extension-buy-modal__variant-\${variant.type}\`" class="sw-extension-buy-modal__variant-description" > {{ variant.label || variant.type }} </label> {% endblock %} {% block sw_extension_buy_modal_variant_selection_variant_list_item_variant_label_rent %} <div v-if="isVariantOfTypeRent(variant)" class="sw-extension-buy-modal__rent" :class="getVariantClasses(variant)" > {% block sw_extension_buy_modal_variant_selection_variant_list_item_variant_label_rent_prices %} <div> <i18n-t :keypath="getVariantPriceSnippet(variant)" tag="span"> <template #price> <strong>{{ getVariantPrice(variant) }}*</strong> </template> </i18n-t> </div> {% endblock %} {% block sw_extension_buy_modal_variant_selection_variant_list_item_variant_label_rent_discount_information %} <div v-if="hasActiveDiscount(variant)"> <i18n-t :keypath="getVariantDiscountInformationSnippet(variant)" tag="span"> <template #months> {{ variant.discountCampaign.discountAppliesForMonths }} </template> <template #price> {{ renderPrice(variant.netPrice) }}* </template> </i18n-t> </div> {% endblock %} {% block sw_extension_buy_modal_variant_selection_variant_list_item_variant_label_rent_additional_information %} <div> <span v-if="isRentDurationYearly(variant)"> <i18n-t keypath="sw-extension-store.general.labelPricePerYear" tag="span"> <template #price> {{ renderPrice(variant.netPrice) }}* </template> </i18n-t> - </span> <span> {{ $t(getVariantCancellationInformationSnippet(variant)) }} </span> </div> {% endblock %} </div> <div v-if="isVariantOfTypeRent(variant) && getVariantBadgeSavings(variant) > 0" class="sw-extension-buy-modal__variants-card-badge" :class="getVariantBadgeClasses(variant)" > {{ $t('sw-extension-store.general.labelSavings', { percentage: getVariantBadgeSavings(variant) }) }} </div> {% endblock %} {% block sw_extension_buy_modal_variant_selection_variant_list_item_variant_label_buy %} <div v-if="isVariantOfTypeBuy(variant)" class="sw-extension-buy-modal__buy" :class="getDiscountClasses(variant)" > {% block sw_extension_buy_modal_variant_selection_variant_list_item_variant_label_buy_prices %} <span v-if="hasActiveDiscount(variant)" class="sw-extension-buy-modal__list-price" > {{ renderPrice(variant.netPrice) }} </span> <span class="sw-extension-buy-modal__discounted-price">{{ renderBuyPrice(variant) }}</span> {% endblock %} </div> {% endblock %} {% block sw_extension_buy_modal_variant_selection_variant_list_item_variant_label_fallback %} <div v-if="!isVariantOfTypeBuy(variant) && !isVariantOfTypeRent(variant)" :class="\`sw-extension-buy-modal__\${variant.type}\`" > <span class="sw-extension-buy-modal__display-default-price"> {{ renderPrice(variant.netPrice) }} </span> </div> {% endblock %} {% endblock %} </li> {% endblock %} </ul> {% endblock %} {% endblock %} </div> {% endblock %} {% block sw_extension_buy_modal_summary %} <div class="sw-extension-buy-modal__variant-summary"> {% block sw_extension_buy_modal_summary_content %} {% block sw_extension_buy_modal_summary_price %} <p class="sw-extension-buy-modal__variant-summary-price"> {% block sw_extension_buy_modal_summary_price_content %} {% block sw_extension_buy_modal_summary_label_price %} <span> {{ $t('sw-extension-store.component.sw-extension-buy-modal.variantSummary.labelPrice') }} </span> {% endblock %} {% block sw_extension_buy_modal_summary_actual_price %} <span v-if="!isLoading" class="sw-extension-buy-modal__variant-summary-actual-price" > <i18n-t :keypath="actualPriceSnippet" tag="span"> <template #price> {{ actualPrice }}* </template> </i18n-t> </span> {% endblock %} {% endblock %} </p> <template v-if="isVariantOfTypeRent(selectedVariant) && firstMonthFree"> <i18n-t v-if="hasActiveDiscount(selectedVariant)" keypath="sw-extension-store.buy-modal.rent.followingDiscount" class="sw-extension-buy-modal__variant-summary-price-subline" tag="p" > <template #price> {{ renderPrice(selectedVariant.discountCampaign.discountedPricePerMonth) }}* </template> <template #months> {{ !isRentDurationMonthly(selectedVariant) ? selectedVariant.duration : selectedVariant.discountCampaign.discountAppliesForMonths }} </template> </i18n-t> <i18n-t :keypath="finalPriceSnippet" class="sw-extension-buy-modal__variant-summary-price-subline is--final-price" tag="p" > <template #price> {{ renderPrice(selectedVariant.netPrice) }}* </template> </i18n-t> </template> {% endblock %} {% block sw_extension_buy_modal_summary_renewal_date %} <p class="sw-extension-buy-modal__variant-summary-price-subline" :class="renewalDateClasses" > {{ $t('sw-extension-store.component.sw-extension-buy-modal.variantSummary.renewal', { renewalDate: dateFilter(renewalDate) }, 0) }} </p> {% endblock %} {% endblock %} </div> {% endblock %} {% block sw_extension_payment_selection %} <sw-single-select v-if="showPaymentSelection" v-model:value="selectedPaymentMean" :options="paymentMeans" :placeholder="$t('sw-extension-store.buy-modal.paymentSelectionPlaceholder')" value-property="id" /> {% endblock %} {% block sw_extension_buy_modal_accept_toc %} <sw-gtc-checkbox v-model:value="tocAccepted" class="sw-extension-buy-modal__checkbox" /> {% endblock %} {% block sw_extension_buy_modal_accept_extension_permissions %} <mt-checkbox v-if="extensionHasPermissions" v-model:checked="permissionsAccepted" class="sw-extension-buy-modal__checkbox sw-extension-buy-modal__checkbox-permissions" :class="\`sw-extension-buy-modal__checkbox-permissions--\${extension.name}\`" > <template #label> <span v-if="legalText"> {{ $t('sw-extension-store.buy-modal.checkboxes.permissionsAndAppProvider.introText') }} <mt-link class="link permissions-modal-trigger" as="a" @click="openPermissionsModal" > {{ $t('sw-extension-store.buy-modal.checkboxes.permissionsAndAppProvider.buttonPermissions') }} </mt-link> {{ $t('sw-extension-store.buy-modal.checkboxes.permissionsAndAppProvider.middleText') }} <mt-link class="link legal-text-modal-trigger" as="a" @click="openLegalTextModal" > {{ $t('sw-extension-store.buy-modal.checkboxes.permissionsAndAppProvider.buttonAppProvider') }} </mt-link> {{ $t('sw-extension-store.buy-modal.checkboxes.permissionsAndAppProvider.endText') }} </span> <span v-else> {{ $t('sw-extension-store.component.sw-extension-buy-modal.labelAcceptPermissions') }} <mt-link class="link permissions-modal-trigger" as="a" @click="openPermissionsModal" > {{ $t('sw-extension-store.detail.labelButtonShowPermissions') }} </mt-link> </span> </template> </mt-checkbox> {% endblock %} {% block sw_extension_buy_modal_accept_extension_app_provider %} <mt-checkbox v-if="!extensionHasPermissions && legalText" v-model:checked="legalTextAccepted" class="sw-extension-buy-modal__checkbox sw-extension-buy-modal__checkbox-app-provider" :class="\`sw-extension-buy-modal__checkbox-app-provider--\${extension.name}\`" > <template #label> {{ $t('sw-extension-store.buy-modal.checkboxes.permissionsAndAppProvider.appProviderStartText') }} <mt-link class="link legal-text-modal-trigger" as="a" @click="openLegalTextModal" > {{ $t('sw-extension-store.buy-modal.checkboxes.permissionsAndAppProvider.buttonAppProvider') }} </mt-link> {{ $t('sw-extension-store.buy-modal.checkboxes.permissionsAndAppProvider.endText') }} </template> </mt-checkbox> {% endblock %} {% block sw_extension_buy_modal_accept_extension_privacy_policy_extensions %} <mt-checkbox v-if="extension.privacyPolicyExtension" v-model:checked="privacyExtensionsAccepted" class="sw-extension-buy-modal__checkbox-privacy-policy" :class="\`sw-extension-buy-modal__checkbox-privacy-policy--\${extension.name}\`" > <template #label> <span class="is--required"> {{ $t('sw-extension-store.component.sw-extension-buy-modal.labelAcceptPrivacyExtensions') }} </span> <mt-link class="link privacy-policy-modal-trigger" as="a" @click="openPrivacyModal" > {{ $t('sw-extension-store.component.sw-extension-buy-modal.buttonShowPrivacyExtensions') }} </mt-link> </template> </mt-checkbox> {% endblock %} {% block sw_extension_buy_modal_alert_can_not_buy %} <mt-banner v-if="!userCanBuyFromStore" variant="info"> {% block sw_extension_buy_modal_alert_can_not_buy_content %} {{ $t('sw-extension-store.component.sw-extension-buy-modal.alertCanNotBuy.text') }} {% endblock %} </mt-banner> {% endblock %} {% block sw_extension_buy_modal_alert_payment_means_required %} <mt-banner v-if="showPaymentWarning" variant="attention"> {% block sw_extension_buy_modal_alert_payment_means_required_content %} {{ $t('sw-extension-store.buy-modal.warnings.paymentMeansRequiredText') }} <sw-external-link :href="cart && cart.payment && cart.payment.registrationUrl" class="sw-extension-buy-modal__external-link" > {{ $t('sw-extension-store.buy-modal.warnings.paymentMeansRequiredLinkText') }} <mt-icon name="regular-long-arrow-right" /> </sw-external-link> {% endblock %} </mt-banner> {% endblock %} {% block sw_extension_buy_modal_plus_vat %} <p class="sw-extension-buy-modal__plus-vat" :class="vatIncludedClasses" > {{ $t('sw-extension-store.buy-modal.plusVat') }} </p> {% endblock %} {% block sw_extension_payment_general_text_block %} <p v-if="paymentText" class="sw-extension-buy-modal__general-text-block" v-html="paymentText" /> {% endblock %} {% block sw_extension_buy_modal_button_purchase %} <mt-button class="sw-extension-buy-modal__purchase-button" size="default" variant="primary" block :disabled="!canPurchaseExtension" @click="purchaseExtension" > {{ purchaseButtonLabel }} </mt-button> {% endblock %} {% endblock %} {% block sw_extension_buy_modal_permissions_modal %} <sw-extension-permissions-modal v-if="showPermissionsModal" :extension-label="extension.label" :domains="extension.domains" :permissions="extension.permissions" @modal-close="closePermissionsModal" /> {% endblock %} {% block sw_extension_buy_modal_privacy_extensions_modal %} <sw-extension-privacy-policy-extensions-modal v-if="showPrivacyModal" :extension-name="extension.label" :privacy-policy-extension="extension.privacyPolicyExtension" @modal-close="closePrivacyModal" /> {% endblock %} {% block sw_extension_buy_modal_legal_text_modal %} <sw-modal v-if="showLegalTextModal" class="sw-extension-buy-modal__legal-text-modal" :title="$t('sw-extension-store.buy-modal.legalTextModal.title')" @modal-close="closeLegalTextModal" > <div v-html="legalText" /> <template #modal-footer> <mt-button variant="primary" size="small" @click="closeLegalTextModal" > {{ $t('global.default.close') }} </mt-button> </template> </sw-modal> {% endblock %} </template> {% endblock %} </sw-modal> {% endblock %}`,{Utils:s}=Shopware,_={template:d,inject:["shopwareExtensionService","extensionStoreService","extensionStoreLicensesService"],emits:["modal-close"],mixins:["sw-extension-error"],props:{extension:{type:Object,required:!0}},data(){return{tocAccepted:!1,selectedVariantId:null,isLoading:!1,permissionsAccepted:!1,legalTextAccepted:!1,showPermissionsModal:!1,showLegalTextModal:!1,privacyExtensionsAccepted:!1,showPrivacyModal:!1,checkoutStep:null,checkoutError:null,cart:null,paymentMeans:[]}},computed:{actualPrice(){const e=this.cart&&this.cart.positions&&this.cart.positions[0],t=e&&e.netPrice;return t&&e&&e.firstMonthFree?s.format.currency(0,"EUR"):t?s.format.currency(t,"EUR",2):s.format.currency(this.extensionStoreService.getPriceFromVariant(this.selectedVariant),"EUR")},actualPriceSnippet(){if(this.extensionStoreService.isVariantOfTypeFree(this.selectedVariant))return"sw-extension-store.general.labelFree";if(this.extensionStoreService.isVariantOfTypeBuy(this.selectedVariant))return"sw-extension-store.general.labelPriceOneTime";const e=this.cart&&this.cart.positions&&this.cart.positions[0];return e&&e.netPrice&&e&&e.firstMonthFree?"sw-extension-store.general.labelPriceFirstMonth":this.isRentDurationYearly(this.selectedVariant)?"sw-extension-store.general.labelPricePerYear":"sw-extension-store.general.labelPricePerMonth"},finalPriceSnippet(){return this.isRentDurationYearly(this.selectedVariant)?"sw-extension-store.buy-modal.rent.yearly.finalPrice":"sw-extension-store.buy-modal.rent.monthly.finalPrice"},recommendedVariants(){return this.extensionStoreService.orderVariantsByRentDuration(this.extension.variants)},selectedVariant(){return this.extension.variants.find(e=>e.id===this.selectedVariantId)},dateFilter(){return s.format.date},purchaseButtonLabel(){return this.isVariantOfTypeFree(this.selectedVariant)?this.$t("sw-extension-store.component.sw-extension-buy-modal.purchaseButtonsLabels.free"):this.isVariantOfTypeRent(this.selectedVariant)?this.$t("sw-extension-store.component.sw-extension-buy-modal.purchaseButtonsLabels.rent"):this.$t("sw-extension-store.component.sw-extension-buy-modal.purchaseButtonsLabels.buy")},vatIncludedClasses(){return{"is--hidden":this.isVariantOfTypeFree(this.selectedVariant)}},renewalDate(){const e=new Date;return this.isRentDurationMonthly(this.selectedVariant)?e.setMonth(e.getMonth()+1):e.setMonth(e.getMonth()+12),e},renewalDateClasses(){return{"is--hidden":this.isVariantOfTypeRent(this.selectedVariant)===!1}},extensionHasPermissions(){return!!Object.keys(this.extension.permissions).length},canPurchaseExtension(){return this.tocAccepted&&this.permissionsAccepted&&this.legalTextAccepted&&this.privacyExtensionsAccepted&&this.userCanBuyFromStore&&!this.showPaymentWarning},userCanBuyFromStore(){return this.tocAccepted,Shopware.Store.get("shopwareExtensions").userInfo!==null},showPaymentWarning(){return(this.paymentMeans||[]).length<=0&&this.cart&&this.cart.payment&&this.cart.payment.paymentMeanRequired},checkoutSteps(){return Object.freeze({CHECKOUT:null,SUCCESS:"checkout-success",FAILED:"checkout-failed"})},showPaymentSelection(){return(this.paymentMeans||[]).length>0&&this.cart&&this.cart.payment&&this.cart.payment.paymentMeanRequired},paymentText(){return!this.cart||!this.cart.payment||!this.cart.payment.paymentText?null:this.$sanitize(this.cart.payment.paymentText,{ALLOWED_TAGS:["a","b","i","u","br","strong","p","br"],ALLOWED_ATTR:["href","target","rel"]})},legalText(){return!this.cart||!this.cart.legalText?null:this.$sanitize(this.cart.legalText,{ALLOWED_TAGS:["a","b","i","u","br","strong","p","br"],ALLOWED_ATTR:["href","target","rel"]})},selectedPaymentMean:{get(){return this.cart&&this.cart.payment&&this.cart.payment.paymentMean&&this.cart.payment.paymentMean.id},set(e){this.cart&&this.cart.payment&&this.cart.payment.paymentMean&&(this.cart.payment.paymentMean.id=e),this.cart.payment.paymentMean={id:e}}},checkoutErrorDocumentationLink(){return s.get(this.checkoutError,"meta.documentationLink",null)},firstMonthFree(){return this.cart&&this.cart.positions[0]&&this.cart.positions[0].firstMonthFree===!0}},async created(){const e=this.recommendedVariants.length>0?this.recommendedVariants[0].id:null;this.setSelectedVariantId(e),this.permissionsAccepted=!this.extensionHasPermissions,this.privacyExtensionsAccepted=!this.extension.privacyPolicyExtension,await this.fetchPlan(),this.legalTextAccepted=!this.legalText},watch:{selectedVariantId(){this.getCart()},userCanBuyFromStore(e){e&&this.getCart()},permissionsAccepted(e){this.legalTextAccepted=e}},methods:{emitClose(){this.isLoading||this.$emit("modal-close")},getDiscountClasses(e){return{"is--discounted":this.hasActiveDiscount(e)}},getVariantPrice(e){return this.extensionStoreService.getCalculatedPrice(e)},getVariantPriceSnippet(e){return this.extensionStoreService.getPriceSnippetForVariant(e)},getVariantDiscountInformationSnippet(e){return this.isRentDurationYearly(e)?"sw-extension-store.buy-modal.rent.yearly.discountInformation":"sw-extension-store.buy-modal.rent.monthly.discountInformation"},getVariantCancellationInformationSnippet(e){return this.isRentDurationYearly(e)?"sw-extension-store.buy-modal.rent.yearly.cancellationInformation":"sw-extension-store.buy-modal.rent.monthly.cancellationInformation"},getVariantClasses(e){return{"is--monthly":this.isRentDurationMonthly(e),"is--yearly":this.isRentDurationYearly(e)}},getVariantBadgeClasses(e){return{"sw-extension-buy-modal__variants-card-badge-discounted":this.hasActiveDiscount(e),"is--monthly":this.isRentDurationMonthly(e),"is--yearly":this.isRentDurationYearly(e)}},getVariantBadgeSavings(e){const t=this.extension.variants.find(c=>this.extensionStoreService.isRentDurationMonthly(c));if(!t)return 0;const n=t.netPrice,o=e.netPrice,i=e.duration,r=o!==n*i,l=this.hasActiveDiscount(e);let a=0;if(r&&l===!1)a=100*(1-o/(n*i));else if(r===!1&&l)a=100*(1-e.discountCampaign.discountedPrice/e.netPrice);else if(r&&l){const c=100*(1-o/(n*i));a=100*(1-e.discountCampaign.discountedPrice/(n*i))-c}return a.toFixed(2).replace(/\.00$/,"")},hasActiveDiscount(e){return this.extensionStoreService.isVariantDiscounted(e)},isRentDurationMonthly(e){return this.extensionStoreService.isRentDurationMonthly(e)},isRentDurationYearly(e){return this.extensionStoreService.isRentDurationYearly(e)},isVariantOfTypeFree(e){return this.extensionStoreService.isVariantOfTypeFree(e)},isVariantOfTypeBuy(e){return this.extensionStoreService.isVariantOfTypeBuy(e)},isVariantOfTypeRent(e){return this.extensionStoreService.isVariantOfTypeRent(e)},setSelectedVariantId(e){this.isLoading||(this.selectedVariantId=e)},variantCardClass(e){return{"is--selected":e.id===this.selectedVariantId}},onChangeVariantSelection(e){this.setSelectedVariantId(e.id)},async purchaseExtension(){this.isLoading=!0;let e=null;try{await this.orderCart(),await this.shopwareExtensionService.updateExtensionData(),e=this.checkoutSteps.SUCCESS}catch(t){this.handleErrors(t),e=this.checkoutSteps.FAILED,s.get(t,"response.data.errors[0]",null)&&(this.checkoutError=t.response.data.errors[0])}finally{await this.shopwareExtensionService.updateExtensionData(),this.checkoutStep=e,this.isLoading=!1}},async orderCart(){await this.extensionStoreLicensesService.orderCart(this.cart)},async getCart(){if(this.userCanBuyFromStore){this.isLoading=!0;try{const e=await this.extensionStoreLicensesService.newCart(this.extension.id,this.selectedVariantId);this.cart=e.data}catch(e){this.handleErrors(e),this.isLoading=!1,this.emitClose()}finally{this.isLoading=!1}}},renderPrice(e){return s.format.currency(e,"EUR")},renderBuyPrice(e){return this.hasActiveDiscount(e)?this.renderPrice(e.discountCampaign.discountedPrice):this.renderPrice(e.netPrice)},handleErrors(e){this.showExtensionErrors(e)},openPermissionsModal(){this.showPermissionsModal=!0},closePermissionsModal(){this.showPermissionsModal=!1},openLegalTextModal(){this.showLegalTextModal=!0},closeLegalTextModal(){this.showLegalTextModal=!1},async fetchPlan(){this.isLoading=!0,await this.shopwareExtensionService.checkLogin(),await this.getPaymentMeans(),this.isLoading=!1},async getPaymentMeans(){this.extensionStoreLicensesService.getPaymentMeans().then(e=>{this.paymentMeans=e.data}).catch(e=>{const t=e.response&&e.response.data&&e.response.data.errors||[];if(!Array.isArray(t)){Shopware.Utils.debug.warn("Payment loading error",e);return}t.forEach(n=>{this.createNotificationError({system:!0,autoClose:!1,growl:!0,title:n.title,message:n.detail})})})},openPrivacyModal(){this.showPrivacyModal=!0},closePrivacyModal(){this.showPrivacyModal=!1}}};export{_ as default};
